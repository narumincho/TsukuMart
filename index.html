<!doctype html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>つくマート 読み込み中</title>
    <link rel="stylesheet" href="style.css">
    <!--<link rel="icon" href="assets/icon.png">-->
</head>

<body>
    <div id="root"></div>
    <script src="main.js"></script>
    <script>
        "use strict";
        /* Elmを起動!! */
        const app = Elm.Main.init({ node: document.getElementById("root") });
        const windowResizeListener = (e) => {
            if (1000 < innerWidth) {
                app.ports.toWideScreenMode.send(0);
            } else {
                app.ports.toNarrowScreenMode.send(0);
            }
        }
        app.ports.studentImageChange.subscribe((id) => {
            const fileInputElement = document.getElementById(id);
            const imageFile = fileInputElement.files[0]
            if (imageFile === undefined) {
                return;
            }
            const fileReader = new FileReader();
            fileReader.addEventListener("load", (e) => {
                app.ports.receiveImageDataUrl.send(fileReader.result)
            })
            fileReader.readAsDataURL(imageFile);
        })
        app.ports.exhibitionImageChange.subscribe((id) => {
            const fileInputElement = document.getElementById(id);
            const imageFiles = fileInputElement.files;
            const fileCount = imageFiles.length;
            const encodedFiles = [];
            for (const imageFile of imageFiles) {
                const fileReader = new FileReader();
                fileReader.addEventListener("load", (e) => {
                    encodedFiles.push(fileReader.result);
                    if (fileCount <= encodedFiles.length) {
                        console.log(encodedFiles);
                        app.ports.receiveImageDataUrlMulti.send(encodedFiles);
                    }
                })
                fileReader.readAsDataURL(imageFile);
            }
        })
        addEventListener("resize", windowResizeListener);
        windowResizeListener();
        // addEventListener("touchmove", (e) => {
        //     e.preventDefault();
        //     // console.log(e.touches[0]);
        // }, { passive: false });
    </script>
</body>