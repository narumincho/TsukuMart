<!doctype html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>つくマート 読み込み中</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/assets/logoBird.png">
    <link rel="manifest" href="/manifest.json">
</head>

<body>
    <div id="root"></div>
    <script src="/main.js"></script>
    <script>
        "use strict";
        /* Elmを起動!! */
        const app = Elm.Main.init({ node: document.getElementById("root") });
        const windowResizeListener = (e) => {
            if (1000 < innerWidth) {
                app.ports.toWideScreenMode.send(null);
            } else {
                app.ports.toNarrowScreenMode.send(null);
            }
        };
        /* ウィンドウサイズのリサイズ情報をElmに送信 */
        addEventListener("resize", windowResizeListener);
        windowResizeListener();
        /* 指定されたidの<input type="file">から1つファイルの情報を受け取りData URLに変換してElmに送信 */
        app.ports.studentImageChange.subscribe(id => {
            const fileInputElement = document.getElementById(id);
            const imageFile = fileInputElement.files[0]
            if (imageFile === undefined) {
                return;
            }
            const fileReader = new FileReader();
            fileReader.addEventListener("load", (e) => {
                app.ports.receiveImageDataUrl.send(fileReader.result)
            })
            fileReader.readAsDataURL(imageFile);
        });
        /* 指定されたidの<input type="file">から複数のファイルの情報を受け取りData URLに変換してElmに送信 */
        app.ports.exhibitionImageChange.subscribe(id => {
            const fileInputElement = document.getElementById(id);
            const result = [];
            for (const imageFile of fileInputElement.files) {
                result.push({
                    file: imageFile,
                    blobUrl: URL.createObjectURL(imageFile)
                });
            }
            console.log(result);
            app.ports.receiveImageFileAndBlobUrl.send(result);
        });

        navigator.serviceWorker.register("/serviceworker.js", { scope: "/" });
    </script>
</body>